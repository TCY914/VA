---
title: "Take-home Exercise 6"
description: |
  Practical Visual Analytics Use: VAST Challenge 2022, Challenge 1 - Social Network, exploring the significant patterns. 
author:
  - name: Joyce Tseng
    url: https://www.linkedin.com/in/joyce-tseng-a7115a1aa/
    affiliation: School of Computing and Information Systems (SMU)
    affiliation_url: https://scis.smu.edu.sg/master-it-business
date: 2022-06-04
preview:
output:
  distill::distill_article:
    self_contained: false
    toc: true
    toc_depth: 3    
---


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, eval = TRUE, message = FALSE, warning = FALSE, fig.retina = 3)
```

# 1. Overview

In this take-home exercise, we reveal the patterns of social activities in Ohio, USA by creating data visualization with `igraph` and `visNetwork`.

With reference to Challenge 2 of [VAST Challenge 2022](https://vast-challenge.github.io/2022/), the social patterns of community in Ohio, USA will be explored.

# 2. Data Preparation
## 2.1 Installing Packages

The following code chunk installs the required R packages and loads them into RStudio environment.

```{r}
packages = c('igraph', 'tidygraph', 'ggraph', 'visNetwork', 'lubridate', 
             'clock','tidyverse')
for(p in packages){
  if(!require(p, character.only = T)){
    install.packages(p)
  }
  library(p, character.only = T)
}
```

## 2.2 Importing the Dataset

```{r eval=FALSE}
SocialNetwork <- read_csv("data/SocialNetwork.csv")
Participants <- read_csv("data/Participants.csv")
```

## 2.3 Data Wrangling

In social network analysis, there are three main components required to plot a graph.

+ ***Node***: represent the source of entity, which refers to vertices in graph theory.
+ ***Edge***: connect the node, which is also called links.

In this exercise, we only use one month data from 2022-03-01 to 2022-03-31.

```{r eval=FALSE}
nodes <- Participants %>%
  rename("id" = "participantId") %>%
  select(id, haveKids)

edges <- SocialNetwork %>%
  filter(timestamp < "2022-04-01") %>%
  select(participantIdFrom, participantIdTo, timestamp) %>%
  rename("source" = "participantIdFrom", "target" = "participantIdTo") %>%
  mutate(Weekday = weekdays(timestamp))
```

```{r eval=FALSE}
x <- c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday",
       "Saturday", "Sunday")

edges_agg1 <- edges %>%
  group_by(source, target, Weekday) %>%
  summarise(Weight = n()) %>%
  mutate(Weekday =  factor(Weekday, levels = x)) %>%
  arrange(Weekday) %>%
  filter(source!=target) %>%
  filter(Weight > 1) %>%
  ungroup
```

```{r eval=FALSE}
fulltable <- edges_agg1 %>%
  left_join(y = nodes, by = c("source" = "id"))
```

```{r write rds, eval=FALSE, echo=FALSE}
saveRDS(nodes, file = "nodes.rds")
saveRDS(edges_agg1, file = "edges_agg1.rds")
saveRDS(fulltable, file = "fulltable.rds")
```

```{r read rds, echo=FALSE}
nodes <- readRDS("data/nodes.rds")
edges_agg1 <- readRDS("data/edges_agg1.rds")
fulltable <- readRDS("data/fulltable.rds")
```

# 3.Data Visualization

To create social network graph, `igraph` package is to create the prepared data for the following visualization.
*graph_from_data_frame()* of igraph is used to covert the nodes and edges data.frame into an igraph file format; while *as_tbl_graph()* of *tidygraph()* is used to convert the igraph file into tidygraph data model.

```{r}
graph1 <- graph_from_data_frame(edges_agg1,
                               vertices = nodes) %>%
  as_tbl_graph()
graph1
```
## 3.1 Overall
### 3.1.1 Social Relationship Between Participants

```{r fig.width= 10, fig.height= 12}
set.seed(12345)

diam <- get_diameter(graph1, directed=T)

V(graph1)$size <- ifelse (V(graph1)$Weight < 4, 1, 3)

vcol <- rep("gray80", vcount(graph1))

vcol[diam] <- "gold"

ecol <- rep("black", ecount(graph1))

ecol[E(graph1, path=diam)] <- "orange" 

deg <- degree(graph1, mode="all")

# E(net, path=diam) finds edges along a path, here 'diam'

plot(graph1, 
     vertex.color=vcol, 
     edge.color=ecol, 
     edge.arrow.mode=0, 
     vertex.size = V(graph1)$size)
```

The graph is interesting that there are two patterns can be observed on social network in Ohio. 

It is obvious that there is a center with lots of crowded edge points on the graph. This represents that people there have more interaction with their friends. However, edge points around with the center means that they do have social activities with others, but they may only hang out with their friends two times a month.

## 3.2 Social Network on Participants with Kids and not
### 3.2.1 Social Visualization on Weekday and Weekend

```{r fig.width= 12, fig.height= 14}
set_graph_style() 
g <- ggraph(graph1, 
            layout = "nicely") + 
  geom_edge_link(aes(width=Weight), 
                 alpha=0.8) +
  scale_edge_width(range = c(1, 5)) +
  geom_node_point(aes(colour = haveKids), 
                  size = 2,
                  alpha=0.6)
g + facet_edges(~Weekday) +
  th_foreground(foreground = "grey80",  
                border = TRUE) +
  theme(legend.position = 'bottom')
```

Here we focus on the social interaction of participants with kids or without kids. We would like to explore whether family with kids would result in more social network, since they may need to bring their child to the  playground or outdoor activities.

The above graphs do not clearly show the differences of social activities between weekday and weekday. The pattern looks similar in each day. Therefore, to observe more clear for the pattern, we would further plot the distribution of social relationship.

### 3.2.2 The Distribution of Social Relationship on Weekday and Weekend

```{r}
g <- ggplot(data = fulltable, aes(x = Weekday, fill = haveKids)) +
  geom_bar(position = "dodge") +  
  labs(x="Weekday", y="Count", fill="Have Kids") +
  theme(axis.title.y= element_text(angle=0), 
        axis.line= element_line(color= 'grey'))
```
![](/Users/joyce/TCY914/VA/_posts/2022-06-04-takehome6/image004.png)

It is interesting that there are more social activities on weekday, especially from Monday to Thursday. The highest count is showed on Thursday. In addition, family without kids has less activities. This is might due to the fact that the number of participants with kid in the data is much less than people without kids. It is surprised that there are less social activities on weekend for people with kids. This may infer that parents pay more attention on their work on weekday and prefer to allocate their time with their children but not have activities with other friends.

